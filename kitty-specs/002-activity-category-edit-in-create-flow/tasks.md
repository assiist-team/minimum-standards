# Work Packages: Activity Category & Edit in Create Flow

**Inputs**: Design documents from `kitty-specs/002-activity-category-edit-in-create-flow/`
**Prerequisites**: plan.md (required), spec.md (user stories), research.md, data-model.md

**Tests**: Not explicitly requested â€” omitted.

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package is independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `tasks/` generated by `/spec-kitty.tasks`.

---

## Work Package WP01: Add Category Picker to ActivityModal (Priority: P1) ðŸŽ¯ MVP

**Goal**: Add a Category picker field to ActivityModal so users can assign a category when creating or editing activities. Covers User Stories 1 & 2 and FR-001 through FR-006.
**Independent Test**: Open ActivityModal in create mode â†’ verify Category field appears between Unit and Notes â†’ select a category â†’ save â†’ verify the activity is created with the selected categoryId. Repeat in edit mode to verify pre-population.
**Prompt**: `tasks/WP01-add-category-picker-to-activity-modal.md`
**Estimated Prompt Size**: ~300 lines

### Included Subtasks
- [x] T001 Import `useCategories` hook and `BottomSheetMenu` component into ActivityModal
- [x] T002 Add `categoryId` and `categoryPickerVisible` state variables
- [x] T003 Add Category picker row JSX between Unit and Notes fields
- [x] T004 Render `BottomSheetMenu` with "None" + user-defined categories
- [x] T005 Update save handler to use `categoryId` state instead of `activity?.categoryId`

### Implementation Notes
- The `categoryId` state must initialize from `activity?.categoryId ?? null` (edit mode) and reset when `activity` prop changes via the existing `useEffect`.
- The save handler at line ~122 currently reads `categoryId: activity?.categoryId ?? null` â€” change this to read from the new `categoryId` state variable.
- The Category row should match the tappable-row pattern used in `ActivitySettingsScreen` (label + current value + chevron icon).
- `BottomSheetMenu` items: first item is `{ key: 'none', label: 'None', onPress: () => setCategoryId(null) }`, followed by `orderedCategories.filter(c => !c.isSystem).map(...)`.

### Parallel Opportunities
- All subtasks are in the same file and must be done sequentially.

### Dependencies
- None (starting package).

### Risks & Mitigations
- **Risk**: `useCategories()` returns empty on first render â†’ Ensure the picker row shows "None" gracefully when categories are loading.
- **Risk**: Category picker z-index conflicts with modal â†’ `BottomSheetMenu` already handles overlay correctly as a nested bottom sheet.

---

## Work Package WP02: Edit Button + Remove Inline Category Picker (Priority: P1)

**Goal**: Replace the broken inline category picker on SelectActivityStep with an Edit button that opens ActivityModal in full edit mode. Covers User Stories 3 & 4 and FR-007 through FR-013.
**Independent Test**: Select an activity on Step 1 â†’ verify Edit button appears â†’ tap Edit â†’ verify ActivityModal opens in edit mode with Category field â†’ change category â†’ save â†’ verify updated category displays on Step 1. Also verify no category picker overlay appears anywhere.
**Prompt**: `tasks/WP02-edit-button-remove-inline-picker.md`
**Estimated Prompt Size**: ~350 lines

### Included Subtasks
- [x] T006 Remove inline category picker state, handler, and overlay JSX
- [x] T007 Remove category picker styles from StyleSheet
- [x] T008 Convert category display from tappable to read-only
- [x] T009 Add `editModalVisible` state and `handleEditActivitySave` callback
- [x] T010 Add Edit button in selected activity details panel
- [x] T011 Add `ActivityModal` instance in edit mode for selected activity

### Implementation Notes
- **Remove** (dead code cleanup per FR-013): `showCategoryPicker` state (line 40), `handleCategoryChange` callback (lines 80-89), overlay JSX (lines 247-306), and 6 style entries (`categoryPickerOverlay`, `categoryPickerContent`, `categoryPickerHeader`, `categoryPickerTitle`, `categoryOption`, `categoryOptionText`).
- **Convert** the category `TouchableOpacity` row (lines 234-242) to a plain `View` â€” remove `onPress` and the edit `MaterialIcons` icon.
- **Add** an Edit button (text or icon) in the `selectionDetails` panel. Only visible when `selectedActivity` is truthy (FR-007, FR-008).
- **Add** a second `<ActivityModal>` below the existing one, in edit mode: `activity={selectedActivity}`, `visible={editModalVisible}`.
- The `handleEditActivitySave` callback should call `updateActivity(selectedActivity.id, activityData)` and then update `selectedActivity` in the builder store to reflect changes (FR-010).
- The existing `useActivities()` Firestore snapshot listener automatically refreshes the activity list, so updates appear without manual refetch.

### Parallel Opportunities
- T006/T007 (removal) and T009/T010/T011 (addition) could be done in parallel by different concerns, but since they're in the same file, sequential is safer.

### Dependencies
- Depends on WP01. The Edit button opens ActivityModal in edit mode, and WP01 adds the Category field to that modal.

### Risks & Mitigations
- **Risk**: Editing the selected activity could cause stale data in `standardsBuilderStore` â†’ Mitigated by calling `setSelectedActivity()` with updated data in the save callback.
- **Risk**: Two `ActivityModal` instances (create + edit) mounted simultaneously â†’ Only one is visible at a time (`showActivityModal` vs `editModalVisible`), so no conflict.

---

## Dependency & Execution Summary

- **Sequence**: WP01 â†’ WP02
- **Parallelization**: None â€” WP02 depends on WP01.
- **MVP Scope**: Both WP01 and WP02 together constitute the MVP. WP01 alone delivers partial value (category in modal) but the full user experience requires WP02 (edit access from create flow).

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Import useCategories and BottomSheetMenu | WP01 | P1 | No |
| T002 | Add categoryId and categoryPickerVisible state | WP01 | P1 | No |
| T003 | Add Category picker row JSX | WP01 | P1 | No |
| T004 | Render BottomSheetMenu with categories | WP01 | P1 | No |
| T005 | Update save handler to use categoryId state | WP01 | P1 | No |
| T006 | Remove inline category picker state/handler/JSX | WP02 | P1 | No |
| T007 | Remove category picker styles | WP02 | P1 | No |
| T008 | Convert category display to read-only | WP02 | P1 | No |
| T009 | Add editModalVisible state and save callback | WP02 | P1 | No |
| T010 | Add Edit button in selection details | WP02 | P1 | No |
| T011 | Add ActivityModal in edit mode | WP02 | P1 | No |
